<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON Admin Control Panel</title>
    <!-- Tailwind CSS for UI -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&display=swap');
        .json-editor { font-family: 'Fira Code', monospace; }
        .loader { border-top-color: #3498db; animation: spinner 1.5s linear infinite; }
        @keyframes spinner { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen">

    <!-- Login Overlay -->
    <div id="loginOverlay" class="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50">
        <div class="bg-gray-800 p-8 rounded-lg shadow-xl w-96 border border-gray-700">
            <h2 class="text-2xl font-bold mb-6 text-center text-blue-400">Admin Login</h2>
            <div class="space-y-4">
                <input type="password" id="adminToken" placeholder="GitHub Access Token" class="w-full p-3 rounded bg-gray-700 border border-gray-600 focus:outline-none focus:border-blue-500">
                <input type="text" id="adminGistId" placeholder="Gist ID" class="w-full p-3 rounded bg-gray-700 border border-gray-600 focus:outline-none focus:border-blue-500">
                <button onclick="login()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded transition duration-200">Login & Connect</button>
            </div>
            <p class="mt-4 text-xs text-gray-400 text-center">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ GitHub Gist ID ‡¶è‡¶¨‡¶Ç Token ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</p>
        </div>
    </div>

    <!-- Main Admin Panel -->
    <div id="adminPanel" class="hidden container mx-auto p-4 md:p-8">
        <header class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
            <div>
                <h1 class="text-3xl font-bold text-white">JSON Control Panel üöÄ</h1>
                <p class="text-gray-400">Gist ID: <span id="displayGistId" class="text-blue-400"></span></p>
            </div>
            <div class="flex gap-3">
                <button onclick="fetchData()" class="bg-gray-700 hover:bg-gray-600 px-6 py-2 rounded-lg font-medium transition">Fetch Data</button>
                <button onclick="logout()" class="bg-red-600 hover:bg-red-700 px-6 py-2 rounded-lg font-medium transition">Logout</button>
            </div>
        </header>

        <main class="grid grid-cols-1 gap-6">
            <!-- Editor Section -->
            <div class="bg-gray-800 rounded-xl border border-gray-700 overflow-hidden shadow-2xl">
                <div class="bg-gray-700 px-4 py-2 flex justify-between items-center">
                    <span class="text-sm font-semibold uppercase tracking-wider text-gray-300">JSON Editor</span>
                    <span id="jsonStatus" class="text-xs font-bold px-2 py-1 rounded bg-green-900 text-green-300">VALID JSON</span>
                </div>
                <textarea id="jsonEditor" class="json-editor w-full h-[500px] p-4 bg-gray-900 text-blue-300 focus:outline-none resize-none text-sm leading-relaxed" spellcheck="false"></textarea>
            </div>

            <!-- Action Section -->
            <div class="flex flex-col md:flex-row items-center justify-between bg-gray-800 p-6 rounded-xl border border-gray-700">
                <div id="statusMessage" class="text-sm font-medium mb-4 md:mb-0">Ready to modify...</div>
                <button onclick="updateData()" id="saveBtn" class="w-full md:w-auto bg-green-600 hover:bg-green-700 text-white px-10 py-3 rounded-lg font-bold shadow-lg transform active:scale-95 transition">
                    SAVE & UPDATE REAL-TIME
                </button>
            </div>
        </main>
    </div>

    <!-- Notification Toast -->
    <div id="toast" class="fixed bottom-5 right-5 hidden bg-white text-gray-900 px-6 py-3 rounded-lg shadow-2xl font-bold"></div>

    <script>
        let GITHUB_TOKEN = "";
        let GIST_ID = "";
        let fileName = "";

        // Login Function
        function login() {
            GITHUB_TOKEN = document.getElementById('adminToken').value;
            GIST_ID = document.getElementById('adminGistId').value;

            if(!GITHUB_TOKEN || !GIST_ID) {
                alert("‡¶¶‡ßü‡¶æ ‡¶ï‡¶∞‡ßá ‡¶∏‡¶¨ ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶®!");
                return;
            }

            fetchData();
        }

        function logout() {
            location.reload();
        }

        // Fetch Data from Gist
        async function fetchData() {
            showToast("‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...", "blue");
            try {
                const response = await fetch(`https://api.github.com/gists/${GIST_ID}`, {
                    headers: { "Authorization": `token ${GITHUB_TOKEN}` }
                });

                if(!response.ok) throw new Error("Invalid Token or ID");

                const data = await response.json();
                fileName = Object.keys(data.files)[0];
                const content = data.files[fileName].content;

                // Format JSON if possible
                try {
                    const parsed = JSON.parse(content);
                    document.getElementById('jsonEditor').value = JSON.stringify(parsed, null, 4);
                } catch {
                    document.getElementById('jsonEditor').value = content;
                }

                document.getElementById('loginOverlay').classList.add('hidden');
                document.getElementById('adminPanel').classList.remove('hidden');
                document.getElementById('displayGistId').innerText = GIST_ID;
                showToast("‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ï‡¶æ‡¶®‡ßá‡¶ï‡ßç‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá!", "green");

            } catch (error) {
                alert("‡¶≠‡ßÅ‡¶≤ ‡¶π‡ßü‡ßá‡¶õ‡ßá! ‡¶ü‡ßã‡¶ï‡ßá‡¶® ‡¶¨‡¶æ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
                showToast("‡¶ï‡¶æ‡¶®‡ßá‡¶ï‡¶∂‡¶® ‡¶´‡ßá‡¶á‡¶≤‡¶°!", "red");
            }
        }

        // Update Data to Gist
        async function updateData() {
            const newContent = document.getElementById('jsonEditor').value;
            const saveBtn = document.getElementById('saveBtn');
            const statusMsg = document.getElementById('statusMessage');

            // JSON Validation
            try {
                JSON.parse(newContent);
            } catch (e) {
                alert("JSON ‡¶´‡¶∞‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ü ‡¶†‡¶ø‡¶ï ‡¶®‡ßá‡¶á! ‡¶¶‡ßü‡¶æ ‡¶ï‡¶∞‡ßá ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
                return;
            }

            saveBtn.disabled = true;
            saveBtn.innerText = "UPDATING...";
            statusMsg.innerText = "GitHub ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞‡ßá ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶ö‡ßç‡¶õ‡ßá...";

            try {
                const response = await fetch(`https://api.github.com/gists/${GIST_ID}`, {
                    method: "PATCH",
                    headers: {
                        "Authorization": `token ${GITHUB_TOKEN}`,
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        files: { [fileName]: { content: newContent } }
                    })
                });

                if (response.ok) {
                    showToast("‡¶∞‡¶ø‡ßü‡ßá‡¶≤-‡¶ü‡¶æ‡¶á‡¶Æ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶∏‡¶´‡¶≤! ‚úÖ", "green");
                    statusMsg.innerText = "‡¶∏‡¶∞‡ßç‡¶¨‡¶∂‡ßá‡¶∑ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü: " + new Date().toLocaleTimeString();
                } else {
                    throw new Error("Update failed");
                }
            } catch (error) {
                showToast("‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!", "red");
            } finally {
                saveBtn.disabled = false;
                saveBtn.innerText = "SAVE & UPDATE REAL-TIME";
            }
        }

        // JSON Live Validator
        document.getElementById('jsonEditor').addEventListener('input', function(e) {
            const statusLabel = document.getElementById('jsonStatus');
            try {
                JSON.parse(e.target.value);
                statusLabel.innerText = "VALID JSON";
                statusLabel.className = "text-xs font-bold px-2 py-1 rounded bg-green-900 text-green-300";
            } catch {
                statusLabel.innerText = "INVALID JSON";
                statusLabel.className = "text-xs font-bold px-2 py-1 rounded bg-red-900 text-red-300";
            }
        });

        function showToast(msg, color) {
            const toast = document.getElementById('toast');
            toast.innerText = msg;
            toast.classList.remove('hidden');
            setTimeout(() => toast.classList.add('hidden'), 3000);
        }
    </script>
</body>
</html>
