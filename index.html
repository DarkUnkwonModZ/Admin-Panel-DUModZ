<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DUMODZ | Ultra-Premium Admin Panel</title>
    
    <!-- CSS Dependencies -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <style>
        :root {
            --primary: #6366f1;
            --accent: #4f46e5;
            --lifetime: #8b5cf6;
            --dark-bg: #030712;
            --glass: rgba(255, 255, 255, 0.05);
            --card-bg: #ffffff;
            --sidebar-w: 280px;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background-color: #f8fafc;
            color: #1e293b;
            overflow-x: hidden;
        }

        /* ðŸ”’ Advanced Login Gate */
        #login-gate {
            position: fixed; inset: 0; background: radial-gradient(circle at center, #1e1b4b, #030712);
            z-index: 9999; display: flex; align-items: center; justify-content: center;
        }
        .login-card {
            background: rgba(255, 255, 255, 0.98); border-radius: 32px;
            padding: 40px; width: 100%; max-width: 400px;
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5);
            animation: fadeInDown 0.8s ease;
        }

        /* ðŸ“± Sidebar & Layout */
        .sidebar {
            width: var(--sidebar-w); background: var(--dark-bg); height: 100vh; position: fixed;
            left: 0; top: 0; color: white; padding: 25px; transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1050;
        }

        .main-wrapper { 
            margin-left: var(--sidebar-w); padding: 40px; 
            transition: 0.4s ease; min-height: 100vh;
        }

        @media (max-width: 991px) {
            .sidebar { left: -100%; }
            .sidebar.active { left: 0; }
            .main-wrapper { margin-left: 0; padding: 20px; }
            .overlay.active { display: block; }
        }

        /* âœ¨ Glass Cards */
        .stat-card {
            background: white; border: 1px solid rgba(0,0,0,0.05); border-radius: 24px;
            padding: 25px; transition: 0.3s; position: relative; overflow: hidden;
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.04);
        }
        .stat-card:hover { transform: translateY(-5px); box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); }
        
        .key-card {
            background: white; border-radius: 20px; border: 1px solid #e2e8f0;
            padding: 20px; position: relative; transition: 0.3s;
        }
        .key-card:hover { border-color: var(--primary); box-shadow: 0 15px 30px rgba(0,0,0,0.05); }

        /* ðŸš¥ Status Badges */
        .badge-active { background: #dcfce7; color: #15803d; }
        .badge-expired { background: #fee2e2; color: #b91c1c; }
        .badge-blocked { background: #f1f5f9; color: #475569; }
        .badge-lifetime { background: #ede9fe; color: #6d28d9; }

        /* âŒ¨ Typing Animation */
        .typing-text::after {
            content: '|'; animation: blink 0.7s infinite;
        }
        @keyframes blink { 50% { opacity: 0; } }

        /* ðŸ”˜ UI Buttons */
        .btn-premium {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white; border: none; border-radius: 12px; font-weight: 600;
            padding: 12px 24px; transition: 0.3s;
        }
        .btn-premium:hover { transform: scale(1.05); box-shadow: 0 10px 20px rgba(99, 102, 241, 0.4); color: white;}

        .floating-add {
            position: fixed; bottom: 30px; right: 30px; z-index: 1000;
            width: 60px; height: 60px; border-radius: 50%; display: flex;
            align-items: center; justify-content: center; font-size: 24px;
        }

        .overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.4);
            backdrop-filter: blur(4px); display: none; z-index: 1040;
        }
    </style>
</head>
<body>

<div class="overlay" id="sidebar-overlay" onclick="toggleSidebar()"></div>

<!-- ðŸ” Login Section -->
<div id="login-gate">
    <div class="login-card text-center">
        <img src="https://raw.githubusercontent.com/DarkUnkwonModZ/Blogger-DarkUnkownModZ-Appinfo/refs/heads/main/IMG/circle-logo-dumodz.png" width="80" class="mb-3 rounded-circle shadow-sm">
        <h3 class="fw-800 mb-1">DUMODZ LOGIN</h3>
        <p class="text-muted small mb-4">Secure Admin Authorization Required</p>
        
        <div class="text-start">
            <label class="small fw-bold text-secondary mb-1">Admin Email</label>
            <input type="text" id="admin-email" class="form-control mb-3 py-3 rounded-4 border-light bg-light" value="du.darkunkwon.info@gmail.com" readonly>
            <label class="small fw-bold text-secondary mb-1">Security Key</label>
            <input type="password" id="admin-pass" class="form-control mb-4 py-3 rounded-4" placeholder="Enter Admin Password">
            <button class="btn btn-premium w-100 py-3" onclick="handleLogin()">Authorize Access</button>
        </div>
    </div>
</div>

<!-- ðŸ“‚ Sidebar -->
<aside class="sidebar" id="sidebar">
    <div class="d-flex align-items-center mb-5 mt-2">
        <img src="https://raw.githubusercontent.com/DarkUnkwonModZ/Blogger-DarkUnkownModZ-Appinfo/refs/heads/main/IMG/circle-logo-dumodz.png" width="45" class="me-3">
        <div>
            <h5 class="fw-bold mb-0">DUMODZ <span class="text-primary">PRO</span></h5>
            <span class="badge bg-primary-subtle text-primary" style="font-size: 10px;">ENTERPRISE V4.5</span>
        </div>
    </div>

    <nav class="flex-column nav">
        <a href="#" class="nav-link text-white active py-3 px-3 rounded-4 mb-2 bg-primary"><i class="fas fa-grid-2 me-3"></i> Dashboard</a>
        <a href="#appConfig" class="nav-link text-secondary py-3 px-3 rounded-4 mb-2"><i class="fas fa-sliders-h me-3"></i> App Config</a>
        <a href="javascript:void(0)" onclick="openAbout()" class="nav-link text-secondary py-3 px-3 rounded-4 mb-2"><i class="fas fa-info-circle me-3"></i> About Admin</a>
    </nav>

    <div style="position: absolute; bottom: 30px; width: calc(100% - 50px);">
        <button class="btn btn-outline-danger w-100 rounded-4 py-2" onclick="handleLogout()">
            <i class="fas fa-sign-out-alt me-2"></i> Logout
        </button>
    </div>
</aside>

<!-- ðŸš€ Main Content -->
<main class="main-wrapper">
    <header class="d-flex justify-content-between align-items-center mb-5">
        <div>
            <h2 class="fw-800 mb-0 typing-text" id="welcome-text">Dashboard Overview</h2>
            <p class="text-muted small">Real-time Cloud Monitoring System</p>
        </div>
        <div class="d-flex gap-2">
            <button class="btn btn-white shadow-sm d-lg-none" onclick="toggleSidebar()"><i class="fas fa-bars"></i></button>
            <button class="btn btn-premium d-none d-md-block" onclick="openKeyModal(-1)">
                <i class="fas fa-plus-circle me-2"></i> Add New Key
            </button>
        </div>
    </header>

    <!-- ðŸ“Š Counter Stats -->
    <div class="row g-3 mb-5">
        <div class="col-6 col-md-3">
            <div class="stat-card">
                <i class="fas fa-key text-primary mb-3 fs-4"></i>
                <h3 class="fw-bold mb-0" id="count-total">0</h3>
                <small class="text-muted fw-bold">TOTAL KEYS</small>
            </div>
        </div>
        <div class="col-6 col-md-3">
            <div class="stat-card border-success-subtle">
                <i class="fas fa-check-circle text-success mb-3 fs-4"></i>
                <h3 class="fw-bold mb-0 text-success" id="count-active">0</h3>
                <small class="text-muted fw-bold">ACTIVE</small>
            </div>
        </div>
        <div class="col-6 col-md-3">
            <div class="stat-card border-danger-subtle">
                <i class="fas fa-clock text-danger mb-3 fs-4"></i>
                <h3 class="fw-bold mb-0 text-danger" id="count-expired">0</h3>
                <small class="text-muted fw-bold">EXPIRED</small>
            </div>
        </div>
        <div class="col-6 col-md-3">
            <div class="stat-card border-primary-subtle">
                <i class="fas fa-infinity text-primary mb-3 fs-4"></i>
                <h3 class="fw-bold mb-0 text-primary" id="count-lifetime">0</h3>
                <small class="text-muted fw-bold">LIFETIME</small>
            </div>
        </div>
    </div>

    <!-- âš™ App Config -->
    <section id="appConfig" class="stat-card border-0 shadow-sm mb-5 animate__animated animate__fadeIn">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h5 class="fw-bold mb-0"><i class="fas fa-tools me-2 text-primary"></i> Master Configuration</h5>
            <button class="btn btn-dark btn-sm rounded-3 px-4" onclick="saveConfig()">Save Updates</button>
        </div>
        <div class="row g-4">
            <div class="col-md-6">
                <label class="small fw-bold text-secondary mb-2">Application Title</label>
                <input type="text" id="cfg-title" class="form-control py-3 rounded-3 mb-3">
                <label class="small fw-bold text-secondary mb-2">Dialog Instructions</label>
                <textarea id="cfg-ins" class="form-control py-3 rounded-3" rows="4"></textarea>
            </div>
            <div class="col-md-6">
                <label class="small fw-bold text-secondary mb-2">Logo URL</label>
                <input type="text" id="cfg-logo" class="form-control py-3 rounded-3 mb-3">
                <label class="small fw-bold text-secondary mb-2">Telegram Shop Link</label>
                <input type="text" id="cfg-buy" class="form-control py-3 rounded-3">
                <div class="form-check form-switch mt-4">
                    <input class="form-check-input" type="checkbox" id="cfg-dialog" style="width: 50px; height: 25px;">
                    <label class="form-check-label ms-3 fw-bold mt-1">Enable Global Login System</label>
                </div>
            </div>
        </div>
    </section>

    <!-- ðŸ”‘ Key Manager -->
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-4 gap-3">
        <h4 class="fw-800 mb-0">Key Management</h4>
        <div class="position-relative" style="max-width: 400px; width: 100%;">
            <i class="fas fa-search position-absolute top-50 start-0 translate-middle-y ms-3 text-muted"></i>
            <input type="text" id="search-db" class="form-control ps-5 py-3 rounded-4 shadow-sm border-0" placeholder="Search by Key or Device ID..." onkeyup="filterKeys()">
        </div>
    </div>

    <div class="row g-4" id="key-container">
        <!-- Rendered by JS -->
    </div>
</main>

<!-- âž• Key Modal -->
<div class="modal fade" id="keyModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 rounded-5 shadow-lg overflow-hidden">
            <div class="modal-header bg-light p-4">
                <h5 class="fw-bold mb-0" id="modal-title">Key Configuration</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-4">
                <input type="hidden" id="edit-idx">
                <div class="mb-3">
                    <label class="small fw-bold mb-1">License Key</label>
                    <div class="input-group">
                        <input type="text" id="key-val" class="form-control py-3 fw-bold" placeholder="DUMODZ-XXXX">
                        <button class="btn btn-primary px-3" onclick="genKey()"><i class="fas fa-sync-alt"></i></button>
                    </div>
                </div>
                <div class="row g-3">
                    <div class="col-12">
                        <label class="small fw-bold mb-1">Expiry Date / Status</label>
                        <div class="input-group">
                            <input type="text" id="key-expiry" class="form-control py-3" placeholder="YYYY-MM-DD">
                            <input type="date" class="form-control" style="max-width: 50px;" onchange="document.getElementById('key-expiry').value=this.value">
                            <button class="btn btn-outline-primary" onclick="document.getElementById('key-expiry').value='Unlimited'">Unlimited</button>
                        </div>
                    </div>
                    <div class="col-6">
                        <label class="small fw-bold mb-1">Status Type</label>
                        <select id="key-status" class="form-select py-3">
                            <option value="active">Active</option>
                            <option value="lifetime">Lifetime</option>
                            <option value="expired">Expired</option>
                            <option value="blocked">Blocked</option>
                        </select>
                    </div>
                    <div class="col-6">
                        <label class="small fw-bold mb-1">Device Binding</label>
                        <input type="text" id="key-device" class="form-control py-3" value="ANY">
                    </div>
                </div>
            </div>
            <div class="modal-footer border-0 p-4 pt-0">
                <button class="btn btn-premium w-100 py-3" onclick="saveKeyData()">Save License Data</button>
            </div>
        </div>
    </div>
</div>

<!-- ðŸ’¡ About Modal -->
<div class="modal fade" id="aboutModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 rounded-5 text-center p-5 shadow-lg">
            <img src="https://raw.githubusercontent.com/DarkUnkwonModZ/Blogger-DarkUnkownModZ-Appinfo/refs/heads/main/IMG/circle-logo-dumodz.png" width="100" class="mx-auto mb-4 rounded-circle border border-primary border-4 p-1">
            <h3 class="fw-800">DUMODZ Enterprise</h3>
            <p class="text-muted">Developed by <b>Dark Unkwon ModZ</b><br>Ultimate Cloud Security Solution</p>
            <div class="d-flex justify-content-center gap-3 my-4">
                <a href="https://t.me/DarkUnkwonModZ" target="_blank" class="btn btn-light rounded-circle shadow-sm" style="width: 50px; height: 50px; display: flex; align-items: center; justify-content: center;"><i class="fab fa-telegram-plane fs-4 text-primary"></i></a>
                <a href="https://darkunkwonmodz.blogspot.com" target="_blank" class="btn btn-light rounded-circle shadow-sm" style="width: 50px; height: 50px; display: flex; align-items: center; justify-content: center;"><i class="fas fa-globe fs-4 text-dark"></i></a>
            </div>
            <button class="btn btn-premium w-100" data-bs-dismiss="modal">Close Window</button>
        </div>
    </div>
</div>

<!-- âš™ Mobile Add Button -->
<button class="btn btn-premium floating-add d-md-none shadow-lg" onclick="openKeyModal(-1)">
    <i class="fas fa-plus"></i>
</button>

<!-- Firebase & Script Logic -->
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut, setPersistence, browserLocalPersistence } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getDatabase, ref, onValue, set, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAqJ-pO0CvynjCCaskOkG6Jiht5a9aVwws",
        authDomain: "key-login-dialog.firebaseapp.com",
        databaseURL: "https://key-login-dialog-default-rtdb.firebaseio.com",
        projectId: "key-login-dialog",
        storageBucket: "key-login-dialog.firebasestorage.app",
        messagingSenderId: "710432558346",
        appId: "1:710432558346:web:e4bc5310b70c652567bef3",
        measurementId: "G-ZZEHBTGKKH"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);
    const rootRef = ref(db, 'key-login-dumodz');
    const keyModal = new bootstrap.Modal(document.getElementById('keyModal'));
    const aboutModal = new bootstrap.Modal(document.getElementById('aboutModal'));
    let masterData = null;

    // --- ðŸ” AUTH SYSTEM ---
    window.handleLogin = async () => {
        const pass = document.getElementById('admin-pass').value;
        if(!pass) return Swal.fire('Error', 'Input Admin Password!', 'error');

        try {
            await setPersistence(auth, browserLocalPersistence);
            await signInWithEmailAndPassword(auth, "du.darkunkwon.info@gmail.com", pass);
            Swal.fire({ title: 'Authorized!', icon: 'success', timer: 1000, showConfirmButton: false });
        } catch (e) {
            Swal.fire('Failed', 'Incorrect Security Password.', 'error');
        }
    };

    window.handleLogout = () => {
        Swal.fire({
            title: 'Logout?',
            text: "Session will be cleared!",
            icon: 'warning',
            showCancelButton: true
        }).then(r => { if(r.isConfirmed) signOut(auth); });
    };

    onAuthStateChanged(auth, (user) => {
        document.getElementById('login-gate').style.display = user ? 'none' : 'flex';
        if(user) syncData();
    });

    // --- ðŸ“Š DATA ENGINE ---
    function syncData() {
        onValue(rootRef, (snap) => {
            masterData = snap.val();
            renderStats();
            renderAppConfig();
            renderKeys();
        });
    }

    function renderStats() {
        const dbList = masterData.auth_database || [];
        document.getElementById('count-total').innerText = dbList.length;
        document.getElementById('count-active').innerText = dbList.filter(x => x.status === 'active').length;
        document.getElementById('count-expired').innerText = dbList.filter(x => x.status === 'expired').length;
        document.getElementById('count-lifetime').innerText = dbList.filter(x => x.status === 'lifetime').length;
    }

    function renderAppConfig() {
        const cfg = masterData.app_config;
        document.getElementById('cfg-title').value = cfg.title;
        document.getElementById('cfg-logo').value = cfg.logo_url;
        document.getElementById('cfg-buy').value = cfg.buy_url;
        document.getElementById('cfg-ins').value = cfg.instruction;
        document.getElementById('cfg-dialog').checked = cfg.dialog_on;
    }

    window.saveConfig = () => {
        const payload = {
            title: document.getElementById('cfg-title').value,
            logo_url: document.getElementById('cfg-logo').value,
            buy_url: document.getElementById('cfg-buy').value,
            instruction: document.getElementById('cfg-ins').value,
            dialog_on: document.getElementById('cfg-dialog').checked
        };
        update(ref(db, 'key-login-dumodz/app_config'), payload)
        .then(() => Swal.fire('Success', 'Configuration Updated!', 'success'));
    };

    function renderKeys() {
        const container = document.getElementById('key-container');
        container.innerHTML = '';
        const list = masterData.auth_database || [];

        list.forEach((item, i) => {
            const badgeClass = `badge-${item.status}`;
            container.innerHTML += `
                <div class="col-12 col-md-6 col-lg-4 key-item animate__animated animate__fadeInUp" data-search="${item.key.toLowerCase()} ${item.device_id.toLowerCase()}">
                    <div class="key-card">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <span class="badge ${badgeClass} text-uppercase px-3 py-2 rounded-3" style="font-size: 10px; font-weight: 800;">${item.status}</span>
                            <div class="dropdown">
                                <button class="btn btn-link text-muted p-0" data-bs-toggle="dropdown"><i class="fas fa-ellipsis-v"></i></button>
                                <ul class="dropdown-menu shadow border-0 rounded-3">
                                    <li><a class="dropdown-item" href="javascript:void(0)" onclick="openKeyModal(${i})"><i class="fas fa-edit me-2"></i> Edit</a></li>
                                    <li><a class="dropdown-item text-danger" href="javascript:void(0)" onclick="deleteKey(${i})"><i class="fas fa-trash me-2"></i> Delete</a></li>
                                </ul>
                            </div>
                        </div>
                        <h5 class="fw-bold mb-1">${item.key}</h5>
                        <p class="small text-muted mb-1"><i class="fas fa-fingerprint me-2"></i>${item.device_id || 'ANY'}</p>
                        <p class="small text-muted mb-3"><i class="fas fa-calendar-alt me-2"></i>${item.expiry}</p>
                        <button class="btn btn-light btn-sm w-100 fw-bold rounded-3" onclick="copyKey('${item.key}')">Copy Access Key</button>
                    </div>
                </div>
            `;
        });
    }

    // --- ðŸ›  ACTIONS ---
    window.openKeyModal = (idx) => {
        document.getElementById('edit-idx').value = idx;
        document.getElementById('modal-title').innerText = idx === -1 ? 'Create New License' : 'Edit License Key';
        
        if(idx === -1) {
            document.getElementById('key-val').value = "";
            document.getElementById('key-expiry').value = "Unlimited";
            document.getElementById('key-status').value = "lifetime";
            document.getElementById('key-device').value = "ANY";
        } else {
            const item = masterData.auth_database[idx];
            document.getElementById('key-val').value = item.key;
            document.getElementById('key-expiry').value = item.expiry;
            document.getElementById('key-status').value = item.status;
            document.getElementById('key-device').value = item.device_id;
        }
        keyModal.show();
    };

    window.saveKeyData = () => {
        const idx = parseInt(document.getElementById('edit-idx').value);
        const newData = {
            key: document.getElementById('key-val').value,
            expiry: document.getElementById('key-expiry').value,
            status: document.getElementById('key-status').value,
            device_id: document.getElementById('key-device').value
        };

        let list = masterData.auth_database || [];
        if(idx === -1) list.push(newData); else list[idx] = newData;

        set(ref(db, 'key-login-dumodz/auth_database'), list)
        .then(() => { keyModal.hide(); Swal.fire('Saved', 'Database Synchronized!', 'success'); });
    };

    window.deleteKey = (idx) => {
        Swal.fire({
            title: 'Delete Key?',
            text: "This action cannot be undone!",
            icon: 'warning',
            showCancelButton: true
        }).then(r => {
            if(r.isConfirmed) {
                let list = masterData.auth_database;
                list.splice(idx, 1);
                set(ref(db, 'key-login-dumodz/auth_database'), list);
            }
        });
    };

    window.genKey = () => {
        document.getElementById('key-val').value = "DUMODZ-" + Math.random().toString(36).substring(2, 10).toUpperCase();
    };

    window.copyKey = (txt) => {
        navigator.clipboard.writeText(txt);
        Swal.fire({ title: 'Copied!', toast: true, position: 'top-end', showConfirmButton: false, timer: 1000, icon: 'success' });
    };

    window.filterKeys = () => {
        const q = document.getElementById('search-db').value.toLowerCase();
        document.querySelectorAll('.key-item').forEach(el => {
            el.style.display = el.dataset.search.includes(q) ? 'block' : 'none';
        });
    };

    window.openAbout = () => aboutModal.show();

    window.toggleSidebar = () => {
        document.getElementById('sidebar').classList.toggle('active');
        document.getElementById('sidebar-overlay').classList.toggle('active');
    };
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
