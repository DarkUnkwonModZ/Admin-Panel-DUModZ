<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DUMODZ | Professional Admin Panel</title>
    
    <!-- CSS Dependencies -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <style>
        :root {
            --primary: #4f46e5;
            --secondary: #64748b;
            --dark: #0f172a;
            --bg: #f8fafc;
            --glass: rgba(255, 255, 255, 0.9);
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--bg);
            color: var(--dark);
            overflow-x: hidden;
        }

        /* ðŸ”’ Login Styles */
        #login-gate {
            position: fixed; inset: 0; background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            z-index: 9999; display: flex; align-items: center; justify-content: center; padding: 20px;
        }
        .login-box {
            background: var(--glass); backdrop-filter: blur(10px);
            padding: 40px; border-radius: 24px; width: 100%; max-width: 450px;
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5);
        }

        /* ðŸ“± Layout & Responsive (768px Focus) */
        .sidebar {
            width: 280px; background: var(--dark); height: 100vh; position: fixed;
            color: white; padding: 25px; transition: all 0.3s ease; z-index: 1000;
        }
        .main-wrapper { margin-left: 280px; padding: 40px; transition: all 0.3s ease; }

        @media (max-width: 992px) {
            .sidebar { transform: translateX(-100%); width: 250px; }
            .main-wrapper { margin-left: 0; padding: 20px; }
            .sidebar.active { transform: translateX(0); }
        }

        /* ðŸŽ´ Premium Cards */
        .stat-card {
            background: white; border: none; border-radius: 20px; padding: 24px;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); transition: 0.3s;
        }
        .stat-card:hover { transform: translateY(-5px); box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
        
        .key-card {
            background: white; border-radius: 20px; border: 1px solid #e2e8f0;
            transition: 0.3s; height: 100%; position: relative; overflow: hidden;
        }
        .key-card:hover { border-color: var(--primary); box-shadow: 0 12px 20px rgba(0,0,0,0.08); }
        
        .status-pill {
            padding: 5px 12px; border-radius: 10px; font-size: 11px; font-weight: 700; text-transform: uppercase;
        }
        .btn-premium {
            background: var(--primary); color: white; border-radius: 12px;
            padding: 10px 24px; font-weight: 600; border: none; transition: 0.3s;
        }
        .btn-premium:hover { background: #4338ca; transform: scale(1.02); }

        .search-container { position: relative; }
        .search-container i { position: absolute; left: 15px; top: 12px; color: var(--secondary); }
        .search-container input { padding-left: 45px; border-radius: 15px; border: 1.5px solid #e2e8f0; }

    </style>
</head>
<body>

<!-- ðŸ” Login Gate -->
<div id="login-gate">
    <div class="login-box text-center">
        <img src="https://raw.githubusercontent.com/DarkUnkwonModZ/Blogger-DarkUnkownModZ-Appinfo/refs/heads/main/IMG/circle-logo-dumodz.png" width="90" class="mb-3 rounded-circle border border-white shadow">
        <h3 class="fw-bold">Dark Unkwon ModZ</h3>
        <p class="text-secondary small mb-4">Professional Access Control</p>
        
        <div class="text-start">
            <div class="mb-3">
                <label class="small fw-bold mb-1">Admin Email</label>
                <input type="text" id="login-email" class="form-control bg-light" value="du.darkunkwon.info@gmail.com" readonly>
            </div>
            <div class="mb-4">
                <label class="small fw-bold mb-1">Enter Password</label>
                <input type="password" id="login-pass" class="form-control form-control-lg border-2" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
            </div>
            <button class="btn btn-premium w-100 py-3" onclick="doLogin()">Unlock Dashboard</button>
        </div>
    </div>
</div>

<!-- ðŸ“‚ Sidebar -->
<aside class="sidebar d-flex flex-column" id="sidebar">
    <div class="mb-5 text-center">
        <h4 class="fw-bold text-white mb-0">DUMODZ PRO</h4>
        <small class="text-secondary">Version 4.0 Premium</small>
    </div>
    <nav class="nav flex-column gap-2">
        <a href="#" class="nav-link text-white bg-primary rounded-4 p-3"><i class="fas fa-th-large me-2"></i> Dashboard</a>
        <a href="#appConfig" class="nav-link text-secondary p-3"><i class="fas fa-sliders-h me-2"></i> App Config</a>
        <a href="#keyManager" class="nav-link text-secondary p-3"><i class="fas fa-key me-2"></i> Key Database</a>
    </nav>
    <div class="mt-auto">
        <button class="btn btn-outline-danger w-100 rounded-4" onclick="doLogout()"><i class="fas fa-sign-out-alt me-2"></i> Logout</button>
    </div>
</aside>

<!-- ðŸš€ Main Content -->
<main class="main-wrapper">
    <header class="d-flex justify-content-between align-items-center mb-5">
        <div class="d-md-none" onclick="toggleSidebar()"><i class="fas fa-bars fs-3"></i></div>
        <div>
            <h2 class="fw-bold mb-0">Hello, Admin!</h2>
            <p class="text-secondary mb-0">Manage your real-time cloud data securely.</p>
        </div>
        <button class="btn btn-premium d-none d-md-block" onclick="openAddModal()">
            <i class="fas fa-plus-circle me-2"></i> Add New License
        </button>
    </header>

    <!-- Stats Grid -->
    <div class="row g-4 mb-5">
        <div class="col-6 col-md-3">
            <div class="stat-card">
                <i class="fas fa-database text-primary mb-3 fs-4"></i>
                <h3 class="fw-bold mb-0" id="stat-total">0</h3>
                <small class="text-secondary">Total Keys</small>
            </div>
        </div>
        <div class="col-6 col-md-3">
            <div class="stat-card">
                <i class="fas fa-check-double text-success mb-3 fs-4"></i>
                <h3 class="fw-bold mb-0" id="stat-active">0</h3>
                <small class="text-secondary">Active</small>
            </div>
        </div>
        <div class="col-6 col-md-3">
            <div class="stat-card">
                <i class="fas fa-ban text-danger mb-3 fs-4"></i>
                <h3 class="fw-bold mb-0" id="stat-expired">0</h3>
                <small class="text-secondary">Expired</small>
            </div>
        </div>
        <div class="col-6 col-md-3">
            <div class="stat-card">
                <i class="fas fa-wifi text-info mb-3 fs-4"></i>
                <h3 class="fw-bold mb-0" id="app-status">ON</h3>
                <small class="text-secondary">Dialog Status</small>
            </div>
        </div>
    </div>

    <!-- App Config Section -->
    <section id="appConfig" class="stat-card mb-5">
        <div class="d-flex justify-content-between mb-4">
            <h5 class="fw-bold"><i class="fas fa-cog me-2"></i> Application Settings</h5>
            <button class="btn btn-sm btn-dark px-4 rounded-3" onclick="saveAppConfig()">Save Changes</button>
        </div>
        <div class="row g-3">
            <div class="col-md-6">
                <label class="small fw-bold text-secondary">App Title</label>
                <input type="text" id="cfg-title" class="form-control mb-3 rounded-3">
                <label class="small fw-bold text-secondary">Instructions</label>
                <textarea id="cfg-ins" class="form-control rounded-3" rows="4"></textarea>
            </div>
            <div class="col-md-6">
                <label class="small fw-bold text-secondary">Logo URL</label>
                <input type="text" id="cfg-logo" class="form-control mb-3 rounded-3">
                <label class="small fw-bold text-secondary">Buy URL (Telegram)</label>
                <input type="text" id="cfg-buy" class="form-control mb-3 rounded-3">
                <div class="form-check form-switch mt-4">
                    <input class="form-check-input" type="checkbox" id="cfg-dialog">
                    <label class="form-check-label fw-bold">Active Login Dialog Window</label>
                </div>
            </div>
        </div>
    </section>

    <!-- Key Database Section -->
    <section id="keyManager">
        <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-4 gap-3">
            <h5 class="fw-bold mb-0">License Database</h5>
            <div class="search-container">
                <i class="fas fa-search"></i>
                <input type="text" id="search-box" class="form-control" placeholder="Search keys..." onkeyup="filterKeys()">
            </div>
        </div>

        <div class="row g-4" id="keys-list">
            <!-- Key cards injected here -->
        </div>
    </section>
</main>

<!-- ðŸ›  License Modal -->
<div class="modal fade" id="keyModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 rounded-5 shadow-lg">
            <div class="modal-header border-0 px-4 pt-4">
                <h5 class="fw-bold" id="modalTitle">Add Access Key</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body px-4 pb-4">
                <input type="hidden" id="edit-index">
                <div class="mb-3">
                    <label class="small fw-bold mb-1">Key Name</label>
                    <div class="input-group">
                        <input type="text" id="f-key" class="form-control fw-bold" placeholder="E.g. VIP-100">
                        <button class="btn btn-outline-primary" onclick="genKey()"><i class="fas fa-magic"></i></button>
                    </div>
                </div>
                <div class="mb-3">
                    <label class="small fw-bold mb-1">Expiry Control (Manual or Calendar)</label>
                    <div class="input-group">
                        <input type="text" id="f-expiry" class="form-control" placeholder="E.g. 2026-12-30 or Lifetime">
                        <input type="date" id="f-date-picker" class="form-control" style="max-width: 45px;" onchange="document.getElementById('f-expiry').value = this.value">
                    </div>
                </div>
                <div class="row g-2">
                    <div class="col-6">
                        <label class="small fw-bold mb-1">Status</label>
                        <select id="f-status" class="form-select">
                            <option value="active">Active</option>
                            <option value="lifetime">Lifetime</option>
                            <option value="expired">Expired</option>
                            <option value="blocked">Blocked</option>
                        </select>
                    </div>
                    <div class="col-6">
                        <label class="small fw-bold mb-1">Device ID</label>
                        <input type="text" id="f-device" class="form-control" placeholder="Empty">
                    </div>
                </div>
            </div>
            <div class="modal-footer border-0 px-4 pb-4">
                <button class="btn btn-light w-100 rounded-3 mb-2" data-bs-dismiss="modal">Cancel</button>
                <button class="btn btn-premium w-100" onclick="saveKey()">Submit Key Information</button>
            </div>
        </div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getDatabase, ref, onValue, set, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAqJ-pO0CvynjCCaskOkG6Jiht5a9aVwws",
        authDomain: "key-login-dialog.firebaseapp.com",
        databaseURL: "https://key-login-dialog-default-rtdb.firebaseio.com",
        projectId: "key-login-dialog",
        storageBucket: "key-login-dialog.firebasestorage.app",
        messagingSenderId: "710432558346",
        appId: "1:710432558346:web:e4bc5310b70c652567bef3",
        measurementId: "G-ZZEHBTGKKH"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);
    const dbPath = 'key-login-dumodz';
    
    let dbData = null;
    const keyModal = new bootstrap.Modal(document.getElementById('keyModal'));

    // --- ðŸ” AUTHENTICATION ---
    window.doLogin = async () => {
        const pass = document.getElementById('login-pass').value;
        const email = "du.darkunkwon.info@gmail.com";
        try {
            await signInWithEmailAndPassword(auth, email, pass);
        } catch (e) {
            Swal.fire('Access Denied', 'Invalid Admin Password!', 'error');
        }
    };

    window.doLogout = () => signOut(auth);

    onAuthStateChanged(auth, (user) => {
        document.getElementById('login-gate').style.display = user ? 'none' : 'flex';
        if (user) startListening();
    });

    // --- ðŸ“Š DATA CORE ---
    function startListening() {
        onValue(ref(db, dbPath), (snap) => {
            dbData = snap.val();
            if (dbData) renderDashboard();
        });
    }

    function renderDashboard() {
        // Render Config
        document.getElementById('cfg-title').value = dbData.app_config.title;
        document.getElementById('cfg-logo').value = dbData.app_config.logo_url;
        document.getElementById('cfg-buy').value = dbData.app_config.buy_url;
        document.getElementById('cfg-ins').value = dbData.app_config.instruction;
        document.getElementById('cfg-dialog').checked = dbData.app_config.dialog_on;
        document.getElementById('app-status').innerText = dbData.app_config.dialog_on ? "ON" : "OFF";

        // Render Stats
        const keys = dbData.auth_database || [];
        document.getElementById('stat-total').innerText = keys.length;
        document.getElementById('stat-active').innerText = keys.filter(k => k.status === 'active' || k.status === 'lifetime').length;
        document.getElementById('stat-expired').innerText = keys.filter(k => k.status === 'expired').length;

        // Render Cards
        const list = document.getElementById('keys-list');
        list.innerHTML = '';
        keys.forEach((k, i) => {
            list.innerHTML += `
                <div class="col-12 col-md-6 col-lg-4 key-item-container" data-search="${k.key.toLowerCase()}">
                    <div class="key-card p-4">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <span class="status-pill bg-light text-dark shadow-sm border">
                                <i class="fas fa-circle me-1" style="color:${getStatusColor(k.status)}"></i> ${k.status}
                            </span>
                            <div class="dropdown">
                                <button class="btn btn-link p-0 text-secondary" data-bs-toggle="dropdown"><i class="fas fa-ellipsis-h"></i></button>
                                <ul class="dropdown-menu dropdown-menu-end border-0 shadow-lg rounded-4">
                                    <li><button class="dropdown-item py-2" onclick="openEditModal(${i})"><i class="fas fa-edit me-2"></i> Edit</button></li>
                                    <li><button class="dropdown-item py-2 text-danger" onclick="deleteKey(${i})"><i class="fas fa-trash-alt me-2"></i> Delete</button></li>
                                </ul>
                            </div>
                        </div>
                        <h5 class="fw-bold mb-1">${k.key}</h5>
                        <div class="text-secondary small mb-3">
                            <div><i class="fas fa-id-badge me-2"></i>ID: ${k.device_id || '---'}</div>
                            <div><i class="fas fa-hourglass-half me-2"></i>Expires: ${k.expiry}</div>
                        </div>
                        <button class="btn btn-light btn-sm w-100 rounded-3 border" onclick="copyKey('${k.key}')">Copy Key</button>
                    </div>
                </div>
            `;
        });
    }

    function getStatusColor(s) {
        if(s === 'active') return '#22c55e';
        if(s === 'lifetime') return '#8b5cf6';
        if(s === 'expired') return '#ef4444';
        return '#64748b';
    }

    // --- ðŸ›  ACTIONS ---
    window.saveAppConfig = () => {
        const payload = {
            buy_url: document.getElementById('cfg-buy').value,
            dialog_on: document.getElementById('cfg-dialog').checked,
            instruction: document.getElementById('cfg-ins').value,
            logo_url: document.getElementById('cfg-logo').value,
            title: document.getElementById('cfg-title').value
        };
        update(ref(db, `${dbPath}/app_config`), payload)
        .then(() => Swal.fire('Success', 'App Configuration Saved!', 'success'));
    };

    window.openAddModal = () => {
        document.getElementById('edit-index').value = "-1";
        document.getElementById('modalTitle').innerText = "Generate New License";
        document.getElementById('f-key').value = "";
        document.getElementById('f-expiry').value = "";
        document.getElementById('f-device').value = "";
        keyModal.show();
    };

    window.openEditModal = (i) => {
        const k = dbData.auth_database[i];
        document.getElementById('edit-index').value = i;
        document.getElementById('modalTitle').innerText = "Edit License Details";
        document.getElementById('f-key').value = k.key;
        document.getElementById('f-expiry').value = k.expiry;
        document.getElementById('f-device').value = k.device_id;
        document.getElementById('f-status').value = k.status;
        keyModal.show();
    };

    window.saveKey = () => {
        const i = parseInt(document.getElementById('edit-index').value);
        const newObj = {
            device_id: document.getElementById('f-device').value,
            expiry: document.getElementById('f-expiry').value,
            key: document.getElementById('f-key').value,
            status: document.getElementById('f-status').value
        };
        let list = dbData.auth_database || [];
        if (i === -1) list.push(newObj); else list[i] = newObj;

        set(ref(db, `${dbPath}/auth_database`), list)
        .then(() => { keyModal.hide(); Swal.fire('Perfect!', 'Database Updated Successfully', 'success'); });
    };

    window.deleteKey = (i) => {
        Swal.fire({ title: 'Delete Key?', text: "You won't be able to revert this!", icon: 'warning', showCancelButton: true }).then(r => {
            if(r.isConfirmed) {
                let list = dbData.auth_database;
                list.splice(i, 1);
                set(ref(db, `${dbPath}/auth_database`), list);
            }
        });
    };

    window.genKey = () => {
        document.getElementById('f-key').value = "DUMODZ-" + Math.random().toString(36).substring(2, 8).toUpperCase();
    };

    window.filterKeys = () => {
        const q = document.getElementById('search-box').value.toLowerCase();
        document.querySelectorAll('.key-item-container').forEach(el => {
            el.style.display = el.dataset.search.includes(q) ? 'block' : 'none';
        });
    };

    window.copyKey = (t) => {
        navigator.clipboard.writeText(t);
        Swal.fire({ title: 'Key Copied!', timer: 1000, showConfirmButton: false, toast: true, position: 'top-end', icon: 'success' });
    };

    window.toggleSidebar = () => document.getElementById('sidebar').classList.toggle('active');

</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
